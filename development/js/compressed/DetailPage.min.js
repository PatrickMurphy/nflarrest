class LoadingBarManager{constructor(){this.options={targetEl:"body",loadingElID:"loading-bar",message:"Loading..."},this.reset()}reset(){$("#"+this.options.loadingElID).length||$(this.options.targetEl).append('<div id="'+this.options.loadingElID+'">'+this.options.message+"</div>"),this.showLoading()}hideLoading(){$("#"+this.options.loadingElID).fadeOut()}showLoading(){$("#"+this.options.loadingElID).fadeIn()}}class Utilities{constructor(){this.googleTracking=new GoogleAnalyticsManager}gaEvent(e,t,a,i,r){this.googleTracking.sendTrackEvent(a,i)}setCookieValue(e,t,a){var i=new Date;a=a||.5,i.setTime(i.getTime()+24*a*60*60*1e3);i="expires="+i.toUTCString();document.cookie=e+"="+t+"; "+i}getCookieValue(e){for(var t=e+"=",a=document.cookie.split(";"),i=0;i<a.length;i++){for(var r=a[i];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}setupFacebook(){var e,t,a,i;window.fbAsyncInit=function(){FB.init({appId:"563956043742586",xfbml:!0,version:"v2.4"}),FB.Event.subscribe("edge.create",function(e){this.googleTracking.sendTrackEvent("facebook","like")}),FB.Event.subscribe("edge.remove",function(e){this.googleTracking.sendTrackEvent("facebook","unlike")}),FB.Event.subscribe("message.send",function(e){this.googleTracking.sendTrackEvent("facebook","send")})},e=document,t="script",a="facebook-jssdk",i=e.getElementsByTagName(t)[0],e.getElementById(a)||((t=e.createElement(t)).id=a,t.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(t,i))}setupTwitter(){var e,t,a,i,r;window.twttr=(e=document,t="script",a="twitter-wjs",i=e.getElementsByTagName(t)[0],r=window.twttr||{},e.getElementById(a)||((t=e.createElement(t)).id=a,t.src="https://platform.twitter.com/widgets.js",i.parentNode.insertBefore(t,i),r._e=[],r.ready=function(e){r._e.push(e)}),r),twttr.ready(function(e){e.events.bind("tweet",function(e){e&&(window.location.href,e.target&&"IFRAME"==e.target.nodeName&&extractParamFromUri(e.target.src,"url"),this.googleTracking.sendTrackEvent("twitter","tweet"))})})}mobileCheck(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,t=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))?!0:t}mobileAndTabletCheck(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,t=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))?!0:t}extractParamFromUri(e,t){if(!e)return null;e=new RegExp("[\\?&#]"+t+"=([^&#]*)").exec(e);return null!=e?decodeURI(unescape(e[1])):null}saveCanvasAsPNG(e){e=document.getElementById(e).toDataURL("image/png").replace("image/png","image/octet-stream");window.location.href=e}update_hash(e){e=e||!1;var t=window.location.pathname.split("/"),t=window.location.hash||extractParamFromUri(window.location.search,"id")||t.pop()||t.pop()||"#!ID Not Set";return e!==(t=(t=(t=decodeURI(t)).replace("#!","")).replace("#",""))&&$("#pageTitle").append(t),t}SetHash(e){window.location.hash=e}}class GoogleAnalyticsManager{constructor(){this.hashervar=window.location.hash||"",this.pagePath=window.location.pathname+this.hashervar,this.loadScript(),ga("create","UA-66360026-1","auto"),this.ping()}loadScript(){var e,t,a,i;e=window,t=document,i="script",a="ga",e.GoogleAnalyticsObject=a,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,a=t.createElement(i),i=t.getElementsByTagName(i)[0],a.async=1,a.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(a,i)}ping(){ga("send","pageview",this.pagePath)}sendTrackEvent(e,t){arguments.length<3&&ga("send","event",e,t)}}var DEBUG=!1;class WebPage{constructor(e,t){this.Utilities=new Utilities,this.StyleManager=new StyleSheetManager,this.LoadingBar=new LoadingBarManager,this.pageTitle=e||"Default",t&&this.LoadingBar.hideLoading(),this.charts=[],this.RenderUpdateDate()}renderView(){}RenderUpdateDate(){var e=lastUpdate.split(",")[0];$("#updateDateFooter").html("Updated: "+e+' <a href="BuildHistory.html">v'+lastVersion+"</a>")}checkLoadingFinished(){}loadingFinished(){this.LoadingBar.hideLoading(),this.Utilities.setupFacebook(),this.Utilities.setupTwitter()}setupFilters(){var e=this.pageTitle.toLowerCase(),t={presets:{},date_range_object:this.dateRangeNFL};t.presets[e]={},t.presets[e][e]=this.pageID,this.FilterControl=new FiltersControl(t),$(this.FilterControl.options.dialog_element).on("FilterDialogChanged",this.renderView)}getDetailPageLink(e,t){return e.charAt(0).toUpperCase()+e.slice(1)+".html#"+t}getCrimeLink(e){return this.getDetailPageLink("Crime",e)}getPlayerLink(e){return this.getDetailPageLink("Player",e)}getTeamLink(e){return this.getDetailPageLink("Team",e)}getPositionLink(e){return this.getDetailPageLink("Position",e)}}class DetailPage extends WebPage{constructor(e,t,a){super(e),this.data_controller,this.pageID=this.Utilities.update_hash(),this.pageTitle=e,this.arrestsUrl=a,this.chartOptions=t,this.arrest_view_mode=0,this.callbackReturns=0,this.arrest_data_all=[];this.Utilities.mobileCheck()&&(this.arrest_view_mode=1),this.StyleManager.loadCSS("css/modules/styles-detailpage.css"),this.StyleManager.loadCSS("css/vendor/pagination.css"),$(window).on("hashchange",()=>{this.renderView(this)}),this.DateRangeControl=new DateRangeControl(this),this.data_controller=new DataController(this.DateRangeControl,this),$("#dateRangeJquery").on("dateRangeChanged",()=>{this.renderView(this)}),setTimeout(()=>{this.resizeCharts()},1500),this.renderView(this)}changeTitle(e,t){t=t||this;document.title="NFL Arrest | "+e+" | List of Player Arrests",$("#pageTitle").html(t.pageTitle+": "+e)}renderView(e){e.LoadingBar.showLoading(),e.pageID=this.Utilities.update_hash(e.pageID),e.changeTitle(),e.setupCharts(),e.renderArrests(),e.resizeCharts(),e.arrest_data_all.length<=(0==e.arrest_view_mode?3:6)&&$("aside").hide()}resizeCharts(){for(var e=0;e<this.charts.length;e++)this.charts[e].chart.resize()}checkLoadingFinished(){++this.callbackReturns==1+this.chartOptions.length&&(this.callbackReturns=0,this.loadingFinished())}renderArrests(){var s=this,a=(e,t)=>{var a,i=[];for(a in 0==s.arrest_view_mode&&i.push(s.renderArrestRowHeader()),e){var r=e[a],r=s.arrest_data_all[r];0==s.arrest_view_mode?i.push(s.renderArrestRow(r)):1==s.arrest_view_mode&&i.push(s.renderArrestCard(r))}0==s.arrest_view_mode?$("#arrest_table").html(i.join("")):1==s.arrest_view_mode&&$("#arrest_cards").html(i.join(""))};s.data_controller.getArrests(e=>{if("Team"==s.pageTitle){if(e.Team!=s.pageID)return!1}else if("Position"==s.pageTitle){if(e.Position!=s.pageID)return!1}else if("Player"==s.pageTitle){if(e.Name!=s.pageID)return!1}else if("Crime"==s.pageTitle&&e.Category!=s.pageID)return!1;return!0},e=>{s.arrest_data_all=e;var t="#arrest_details_incident_count";$(t).html(e.length+" Incidents:"),0==s.arrest_view_mode?($(t).after('<table id="arrest_table"></table>'),$("#arrest_table").after('<div id="pagination-control"></div>')):1==s.arrest_view_mode&&($(t).after('<div id="arrest_cards"></div>'),$("#arrest_cards").after('<div id="pagination-control"></div>')),$("#pagination-control").pagination({dataSource:Array.from(s.arrest_data_all.keys()),callback:a,afterRender:function(){s.Utilities.googleTracking.sendTrackEvent("DetailPageArrests","Change Page")},autoHidePrevious:!0,autoHideNext:!0,showNavigator:!0,className:"paginationjs-theme-yellow paginationjs-big",pageSize:0==s.arrest_view_mode?15:5,pageRange:0==s.arrest_view_mode?2:1}),s.checkLoadingFinished()})}renderArrestRowHeader(){return'<tr><th class="one column">Date:</th><th class="one column">Team:</th><th class="two columns">Name:</th><th class="one column">Crime:</th><th class="four columns">Description:</th><th class="three columns">Outcome:</th></tr>'}renderArrestRow(e){var t="<tr>";return t+='<td class="one column">'+moment(e.Date,"YYYY-MM-DD").fromNow()+"</td>",t+='<td class="one column">'+e.Team+"</td>",t+='<td class="two columns"><a href="Player.html#'+e.Name+'">'+e.Name+"</a></td>",t+='<td class="one column"><a href="Crime.html#'+e.Category+'">'+e.Category+"</a></td>",t+='<td class="four columns">'+e.Description+"</td>",t+='<td class="three columns">'+e.Outcome+"</td>",t+="</tr>"}renderArrestCard(e){return new ArrestCard(this,e).getHTML()}getDonutData(e,s,n,o){var l=this;l.data_controller.getDonutChart(s,e=>{if("Team"==l.pageTitle){if(e.Team!=l.pageID)return!1}else if("Position"==l.pageTitle){if(e.Position!=l.pageID)return!1}else if("Player"==l.pageTitle){if(e.Name!=l.pageID)return!1}else if("Crime"==l.pageTitle&&e.Category!=l.pageID)return!1;return!0},e=>{var t,a=[],i=0,r=["Other",0];for(t in e)++i<12?a.push([e[t][s],e[t].arrest_count]):r[1]=parseInt(r[1])+parseInt(e[t].arrest_count);a.push(r),l.checkLoadingFinished(),o(a,n)})}setupCharts(){var e,a=this;for(e in a.chartOptions){var t=a.chartOptions[e];a.getDonutData(t.url+a.pageID,t.field,e,(e,t)=>{a.charts.push(new DonutChart({data:e,targetElement:a.chartOptions[t].targetElement,chartTitle:a.chartOptions[t].title},a))})}}}class FiltersModel{constructor(){this.filter_types={date_range_controller:{name:"dateRangeController",names:["start_date","end_date"],library:"NFLArrest",description:"The NFL Date Range Controller Module, contains two values",default_val:["2000-01-01",dateRangeController.getToday()],getValue:function(e,t){var a=[];return a.push(e.dateRangeNFL.start_date),a.push(e.dateRangeNFL.end_date),a},isActive:function(e,t){var a=e.dateRangeNFL.start_date!=t.type.default_val[0],t=e.dateRangeNFL.end_date!=t.type.default_val[1];return a||t}},select:{name:"select",library:"Chosen",description:"multi select field for filters, contains an array of values",default_val:null,getValue:function(e,t){return $(t.element).val()},isActive:function(e,t){return $(t.element).val()!=t.type.default_val}},checkbox_group:{name:"checkbox-group",library:"JQuery-UI",description:"a group of binary options",default_val:"all",getValue:function(e,t){var a=[];return $(t.element).map(function(e,t){$(t).prop("checked")?a.push("0"):a.push("1")}),a.join("")},isActive:function(e,t){var a=0;return $(t.element).map(function(e,t){$(t).prop("checked")||a++}),0<a}},checkbox:{name:"checkbox",library:"JQuery-UI",description:"a single binary option",default_val:!1,getValue:function(e,t){return $(t.element).prop("checked")},isActive:function(e,t){return $(t.element).prop("checked")!=t.type.default_val}}},this.filter_items={daterange:{element:"#filter-daterange-input",type:this.filter_types.date_range_controller,name:["start_date","end_date"]},month:{element:"#filter-month-input",type:this.filter_types.select,name:"month[]"},dayofweek:{element:"#filter-dayofweek-input-mon, #filter-dayofweek-input-tues, #filter-dayofweek-input-wed, #filter-dayofweek-input-thur, #filter-dayofweek-input-fri, #filter-dayofweek-input-sat, #filter-dayofweek-input-sun",type:this.filter_types.checkbox_group,name:"dayofweek"},yeartodate:{element:"#filter-yeartodate-input",type:this.filter_types.checkbox,name:"yeartodate"},season:{element:"#filter-season-input",type:this.filter_types.select,name:"season[]"},season_status:{element:"#filter-seasonStatusOn-input, #filter-seasonStatusOff-input",type:this.filter_types.checkbox_group,name:"season_status"},team:{element:"#filter-team-input",type:this.filter_types.select,name:"team[]"},conference:{element:"#filter-conference-AFC-input, #filter-conference-NFC-input",type:this.filter_types.checkbox_group,name:"conference"},division:{element:"#filter-division-input",type:this.filter_types.select,name:"division[]"},crimeCategory:{element:"#filter-crime-category-input",type:this.filter_types.select,name:"crimeCategory[]"},crime:{element:"#filter-crime-input",type:this.filter_types.select,name:"crime[]"},position:{element:"#filter-position-input",type:this.filter_types.select,name:"position[]"},position_type:{element:"#filter-position-type-input-o, #filter-position-type-input-d, #filter-position-type-input-s",type:this.filter_types.checkbox_group,name:"position_type"},player:{element:"#filter-player-input",type:this.filter_types.select,name:"player[]"}},this.filter_sections={date:{title:"Date Filters",element:"#filter-date-section",items:[this.filter_items.daterange,this.filter_items.month,this.filter_items.dayofweek,this.filter_items.yeartodate]},season:{title:"Season Filters",element:"#filter-season-section",items:[this.filter_items.season,this.filter_items.season_status]},team:{title:"Team Filters",element:"#filter-team-section",items:[this.filter_items.team,this.filter_items.conference,this.filter_items.division]},crime:{title:"Crime Filters",element:"#filter-crime-section",items:[this.filter_items.crimeCategory,this.filter_items.crime]},position:{title:"Position Filters",element:"#filter-position-section",items:[this.filter_items.position,this.filter_items.position_type]},player:{title:"Player Filters",element:"#filter-player-section",items:[this.filter_items.player]}}}}class FiltersControl{constructor(e){this.options=e||{},this.options.hidden_panels=e.hidden_panels||[],this.options.presets=e.presets||{},this.options.date_range_object=e.date_range_object||{},this.options.dialog_element_container=e.dialog_element_container||"#filter-dialog-container",this.options.dialog_element=e.dialog_element||"#filter-dialog",this.options.dialog_content_url=e.dialog_content_url||"templates/FiltersTemplateCache.html",this.filters_model=new FiltersModel,this.dateRangeNFL=this.options.date_range_object,this.first_open=!0;var t=this;$("#filters-open-button").click(function(){t.show()}),$("#filter-dialog-container").click(function(e){"filter-dialog-container"==e.target.id&&t.hide()}),this.hide()}on(e,t){e&t&&$(self.options.dialog_element).on(e,t)}show(){$(this.options.dialog_element_container).show(),this.first_open&&(this.loadDialogContents(),this.first_open=!1)}hide(){$(this.options.dialog_element_container).hide()}loadDialogContents(){var e=this;loadCSS("css/modules/styles-filters.css"),loadCSS("css/vendor/chosen.min.css"),$(e.options.dialog_element_container).load(e.options.dialog_content_url,function(){e.setupView(),e.renderView()})}setupFilterPresets(){for(var e in this.options.presets){var t,a=this.options.presets[e];for(t in a){a[t];switch(t){case"team":case"crime":case"position":case"player":this.options.hidden_panels.push(t)}}}}setupFilterInput(e){$(".filter-chosen-multi").chosen({inherit_select_classes:!0,hide_results_on_select:!1}).change(e),$(".filter-radio-group input").checkboxradio({icon:!1}).change(e),$("#dateRangeJquery").on("dateRangeChanged",e),$(".filter-type-btn").click(function(){$(this).removeClass("filter-include filter-exclude"),"Exclude"===$(this).html()?($(this).html("Include"),$(this).addClass("filter-include")):($(this).html("Exclude"),$(this).addClass("filter-exclude"))})}setupUserInterface(){var e=this;$(".filter-section-title").click(function(){$(this).parent().children().eq(1).toggle()}),$("#filters-close-button").click(function(){$(e.options.dialog_element).trigger("FilterDialogClosed"),e.hide()}),$("#filters-apply-button").click(function(){e.apply(),$(e.options.dialog_element).trigger("FilterDialogChanged"),$(window).trigger("hashchange"),e.hide()}),$("#filters-clear-button").click(function(){e.reset(),$(e.options.dialog_element).trigger("FilterDialogReset")}),$("#filters-cancel-button").click(function(){e.hide()})}apply(){var e,t=this.getFilterValues();for(e in t)for(var a in t[e])setCookieValue(a,t[e][a])}reset(){for(var e in this.filters_model.filter_sections)if(this.filters_model.filter_sections.hasOwnProperty(e)){var t,a=this.filters_model.filter_sections[e].items;for(t in a)if(a.hasOwnProperty(t)){var i=a[t];if(Array.isArray(i.type.default_val)&&i.type.hasOwnProperty("names")){var r,s=0;for(r in i.type.default_val)setCookieValue(i.type.names[s],i.type.default_val[s++])}else setCookieValue(t,i.type.default_val)}}this.loadDialogContents()}onFilterChanged(e,t,a){t=t.currentTarget.getAttribute("id"),t=t.substring(t.indexOf("-")+1,t.length);t.substring(0,t.lastIndexOf("-"));e.renderView()}setupView(){var a=this;this.setupFilterPresets(),this.setupUserInterface(),this.setupFilterInput(function(e,t){a.onFilterChanged(a,e,t)})}renderView(){var e,t=this;for(e in this.countActiveFilters(),t.options.hidden_panels)switch(t.options.hidden_panels[e]){case"team":case"crime":case"position":case"player":$(t.filters_model.filter_sections[t.options.hidden_panels[e]].element).hide()}$("#filter-daterange-input").html(t.dateRangeNFL.getStart()+"-"+t.dateRangeNFL.getEnd()),$("#filter-date-section .filter-section-title span").html(this.filters_model.filter_sections.date.active_count+"/4"),$("#filter-season-section .filter-section-title span").html(this.filters_model.filter_sections.season.active_count+"/2"),$("#filter-team-section .filter-section-title span").html(this.filters_model.filter_sections.team.active_count+"/3"),$("#filter-crime-section .filter-section-title span").html(this.filters_model.filter_sections.crime.active_count+"/2"),$("#filter-position-section .filter-section-title span").html(this.filters_model.filter_sections.position.active_count+"/2"),$("#filter-player-section .filter-section-title span").html(this.filters_model.filter_sections.player.active_count+"/1")}countActiveFilters(){for(var e in this.filters_model.filter_sections)if(this.filters_model.filter_sections.hasOwnProperty(e)){var t,a,i,r=this.filters_model.filter_sections[e];for(t in r.active_count=0,r.items)r.items.hasOwnProperty(t)&&(i=(a=r.items[t]).type.isActive(this,a),(a.active=i)&&r.active_count++)}}getFilterValues(){var e,t={};for(e in this.filters_model.filter_sections)if(this.filters_model.filter_sections.hasOwnProperty(e)){var a,i=this.filters_model.filter_sections[e].items;for(a in i)if(i.hasOwnProperty(a)){var r=i[a],s=r.name,n=r.type.getValue(this,r);if(r.active)if(t.hasOwnProperty(e)||(t[e]={}),Array.isArray(n)&&r.type.hasOwnProperty("names")){var o,l=0;for(o in n)t[e][r.type.names[l++]]=n[o]}else t[e][s]=n}}return t}getQueryString(){var e,t=this.getFilterValues(),a=[];for(e in t=Object.assign(t,this.options.presets))for(var i in t[e])if(Array.isArray(t[e][i]))for(var r in t[e][i])a.push(i+"="+t[e][i][r]);else a.push(i+"="+t[e][i]);return a.join("&")}}class Chart{constructor(e,t,a){this.chart=void 0,this.parent=a,this.options={targetElement:"#theElementSelector",chartTitle:"default",data:{}},this.defaultColorPattern=["#1F77B4","#FF7F0E","#2CA02C","#D62728","#9467BD","#8C564B","#E377C2","#7F7F7F","#BCBD22","#17BECF","#154F78","#B0580A","#248224","#7D1717"],$.extend(!0,this.options,e),this.chartType=t||"donut",this.options.$targetElement=$(this.options.targetElement),this.renderChart()}renderChart(){console.warn("WARNING: Using default render chart");var e={bindto:this.options.targetElement,data:{columns:this.options.data,type:this.chartType},color:{pattern:["#1F77B4","#FF7F0E","#2CA02C","#D62728","#9467BD","#8C564B","#E377C2","#7F7F7F","#BCBD22","#17BECF","#154F78","#B0580A","#248224","#7D1717"]}};"donut"==this.chartType&&(e.donut={title:this.options.chartTitle}),this.chart=c3.generate(e)}}class DonutChart extends Chart{constructor(e,t){super(e,"donut",t),this.renderChart()}renderChart(){var e={bindto:this.options.targetElement,data:{columns:this.options.data,type:this.chartType},donut:{title:this.options.chartTitle},color:{pattern:this.defaultColorPattern}};this.chart=c3.generate(e)}}var lastUpdate="1/24/2022, 3:58:31 AM",lastVersion="2.12.14";class ArrestCard{constructor(e,t,a){if(this.parent=e,this.row=t,this.options=a||{showName:!1,momentDate:!1,standalone:!1},this.options.momentDate=99<this.row.DaysSince,this.addDimensions(),!this.row.hasOwnProperty("Team_preffered_name"))throw"error: incorrect row definition"}addDimensions(){this.Dimension_Team={dimension_id:0,dimension_name:"Team",data_column:"Team",color:"Team_hex_color",url:"Team.html",display:"Team_preffered_name",color2:"Team_hex_alt_color",useColor2:!0},this.Dimension_Player={dimension_id:2,dimension_name:"Player",data_column:"Name",color:"Team_hex_color",url:"Player.html",display:"Name",color2:"Team_hex_alt_color",useColor2:!0},this.Dimension_Position={dimension_id:3,dimension_name:"Position",data_column:"Position",color:"Team_hex_color",url:"Position.html",display:"Position",color2:"Team_hex_alt_color",useColor2:!0},this.Dimension_Crime={dimension_id:1,dimension_name:"Crime",data_column:"Category",color:"Crime_category_color",url:"Crime.html",display:"Category"}}getHTML(e,t,a){var e=e||this.Dimension_Crime,t=t||this.Dimension_Team,a=a||{},i=this.options.showName?' style="display:inline-block; visibility:visible;"':"",r=this.options.momentDate?moment(this.row.Date,"YYYY-MM-DD").fromNow():this.row.DaysSince+" days ago",s=t.useColor2?'style="color:#'+this.row[t.color2]+';"':"",n=['<div class="card arrest_card '+(this.options.standalone?" standalone_card":"")+'">'];return n.push('<span class="date_item" title="'+this.row.Date+'">'+r+"</span>"),n.push('<span class="name_item"'+i+'><a href="Player.html#'+this.row.Name+'">'+this.row.Name+"</a> </span>"),n.push("<br />"),n.push('<span class="crime_item" style="background-color:#'+this.row[e.color]+'">'),n.push('<a href="'+e.url+"#"+this.row[e.data_column]+'">'+this.row[e.display]+"</a> </span>"),n.push('<span class="team_item '+this.row[t.data_column]+'" style="background-color:#'+this.row[t.color]+';">'),n.push('<a href="'+t.url+"#"+this.row[t.data_column]+'" '+s+" >"+this.row[t.display]+"</a></span>"),a.hasOwnProperty("data_column")&&n.push('<br /><span class="arrest_card_detail_links">'+a.dimension_name+': <a href="'+a.url+"#"+this.row[a.data_column]+'">'+this.row[a.data_column]+"</a></span>"),n.push("<br />"),n.push('<span class="description_item">'+this.row.Description+"</span>"),n.push('<span class="outcome_item">'+this.row.Outcome+"</span>"),n.push("</div>"),n.join("")}}class DataController{constructor(e,t){this.DateRangeControl=e,this.parent=t,this.data=ArrestsCacheTable,this.PreProcessData()}PreProcessData(){this.PreProcessData_DaysSince(),this.PreProcessData_SortOrder()}PreProcessData_DaysSince(){this.forEach((e,t)=>{this.data[t].DaysSince=function(e,t){e=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),t=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());return Math.floor((t-e)/864e5)}(new Date(e.Date),new Date)})}PreProcessData_SortOrder(){this.data.sort(function(e,t){return e.DaysSince<t.DaysSince?1:e.DaysSince>t.DaysSince?-1:0})}forEach(e,t,a){t=t||function(){},a=a||!0;for(var i=this.data.length-1;0<=i;i--){var r=this.data[i];(!a||this.dateLimit(r,this.DateRangeControl.getStart(),this.DateRangeControl.getEnd()))&&e(r,i)}t()}incrementMap(e,t){return e.hasOwnProperty(t)?e[t]=e[t]+1:e[t]=1,e}dateLimit(e,t,a){return new Date(e.Date)>=new Date(t)&&new Date(e.Date)<=new Date(a)}getActivePlayerArrests(e){e(["no data"])}getMostRecentArrest(e){var t,a=999999999;this.forEach(e=>{this.dateLimit(e,this.DateRangeControl.getStart(),this.DateRangeControl.getEnd())&&e.DaysSince<a&&(a=(t=e).DaysSince)},()=>{e(t)})}getTeams(e){for(var t=[],a=new Map,i=this.data.length-1;0<=i;i--){var r=this.data[i],r={Team:r.Team,Team_preffered_name:r.Team_preffered_name,Team_logo_id:r.Team_logo_id};a.has(r.Team)||(a.set(r.Team,!0),t.push(r))}e(t)}getArrestMeter(e){var a=0,i=-1,r=0,s=9e9;this.forEach((e,t)=>{r++,a+=e.DaysToLastArrest,e.DaysToLastArrest>i&&(i=e.DaysToLastArrest),e.DaysSince<s&&(s=e.DaysSince)}),a/=r,e({alltime:{record:Math.floor(i),average:Math.floor(a),raw_average:Math.floor(a)},current:{daysSince:Math.floor(s),probability:Math.exp(-1*s)/a,odds:Math.floor(1/Math.exp(-1*s/a))}})}getDonutChart(a,e,t){for(var i={},r=[],s=this.data.length-1;0<=s;s--){var n=this.data[s];e(n)&&this.dateLimit(n,this.DateRangeControl.getStart(),this.DateRangeControl.getEnd())&&(i=this.incrementMap(i,n[a]))}Object.keys(i).forEach(e=>{var t={};t[a]=e,t.arrest_count=i[e],r.push(t)}),t(r.sort(function(e,t){return t.arrest_count-e.arrest_count}))}getOverallChart(e,t,a,i,r){for(var s={Year:"Year",Month:"Month",Day:"Day_of_Week",DayOrder:"Day_of_Week_int",Team:"Team_preffered_name","Team Code":"Team",Conference:"Team_Conference",Division:"Team_Conference_Division",Position:"Position",Crime:"Crime_category",Season:"Season",SeasonState:"ArrestSeasonState",Measure:"arrest_count"},n=s[t],o=s[e],l=s[a],i=i,c={},h={},d={},m={},p=this.data.length-1;0<=p;p--){var g=this.data[p];this.dateLimit(g,this.DateRangeControl.getStart(),this.DateRangeControl.getEnd())&&(c=this.incrementMap(c,g[n]+g[o]),h=this.incrementMap(h,g[n]),d=this.incrementMap(d,g[o]),m[g[n]]=g[l])}var u=[];Object.keys(h).forEach(e=>{var t={bar:e,arrest_count:h[e]};t[l]=m[e],u.push(t)}),"DESC"==i&&l==n?u.sort(function(e,t){return t.arrest_count-e.arrest_count}):"ASC"==i&&"Day_of_Week_int"==l&&u.sort((e,t)=>e[l]-t[l]);var f=[];Object.keys(d).forEach(e=>{f.push(e)});var _=["x"];u.forEach(e=>{_.push(e.bar)});var y=[];y.push(_),Object.keys(d).forEach(t=>{var a=[t];u.forEach(e=>{e=e.bar,e=c[e+t];a.push(e=null==e?0:e)}),y.push(a)}),r({columns:y,groups:f})}getTopLists(e,t,a,i){for(var r=[],s={},n={},o={},l=[],c=[],h=[],d=this.data.length-1;0<=d;d--){var m=this.data[d];this.dateLimit(m,this.DateRangeControl.getStart(),this.DateRangeControl.getEnd())&&(s=this.incrementMap(s,m.Category),n=this.incrementMap(n,m.Name),o=this.incrementMap(o,m.Position))}Object.keys(s).forEach(e=>{var t={};t.Category=e,t.arrest_count=s[e],l.push(t)}),Object.keys(n).forEach(e=>{var t={};t.Name=e,t.arrest_count=n[e],c.push(t)}),Object.keys(o).forEach(e=>{var t={};t.Position=e,t.arrest_count=o[e],h.push(t)});function p(e,t){return t.arrest_count-e.arrest_count}r.push(l.sort(p).slice(e,e+5)),r.push(c.sort(p).slice(e,e+5)),r.push(h.sort(p).slice(e,e+5)),i(r)}getArrests(t,e){var a=[];this.forEach(e=>{this.dateLimit(e,this.DateRangeControl.getStart(),this.DateRangeControl.getEnd())&&t(e)&&a.push(e)},()=>{e(a)})}}var timeSeriesChart={timeChart:void 0,options:{targetElement:"#theElementSelector",compareToBtn:"#btnSelector",initColumnID:"",data:{},isExpanded:!1,showAccumulation:!1,ajaxURL:"/api/"},init:function(e,t){$.extend(!0,this.options,e),this.parent=t;var a=this;a.options.$targetElement=$(this.options.targetElement),a.options.$expandBtnElement=$(this.options.targetExpandBtn),timeSeriesChart.options.$expandBtnElement.off("click"),timeSeriesChart.options.$expandBtnElement.click(function(){a.toggleExpand(a)}),a.renderChart()},renderChart:function(){var e;e=$(document).width()<800?20:6,timeSeriesChart.timeChart=c3.generate({bindto:timeSeriesChart.options.targetElement,data:{x:"x",columns:[timeSeriesChart.getXDates(),timeSeriesChart.fillDates(timeSeriesChart.options.initColumnID,timeSeriesChart.options.data)]},axis:{x:{type:"timeseries",tick:{format:"%m/%y"}}},padding:{bottom:e},color:{pattern:["#1F77B4","#FF7F0E","#2CA02C","#D62728","#9467BD","#8C564B","#E377C2","#7F7F7F","#BCBD22","#17BECF","#154F78","#B0580A","#248224","#7D1717"]}})},buildAjaxURL:function(e,t){t=t||{};var a,i,r={id:e,start_date:dateRangeController.getStart(),end_date:dateRangeController.getEnd()};for(i in $.extend(r,t),a=timeSeriesChart.options.ajaxURL.indexOf("?")<0?"?":"&",r)a+=i+"="+r[i]+"&";return a=a.substring(0,a.length-1),timeSeriesChart.options.ajaxURL+a},addColumn:function(t){this.parent.Utilities.googleTracking.sendTrackEvent("TimeChart","addCompare "+t);var e=timeSeriesChart.buildAjaxURL(t);$.getJSON(e,function(e){e=timeSeriesChart.fillDates(t,e);e[0];timeSeriesChart.timeChart.load({columns:[e]})})},fillDates:function(e,t){e=e||"",t=(t=t||[]).reverse();for(var a,i=new Date(dateRangeController.getStart()),r=new Date(dateRangeController.getEnd()),r=12*(r.getFullYear()-i.getFullYear())+(r.getMonth()-i.getMonth())+1,s=i.getFullYear(),n=i.getMonth()+1,o=[e.toString()],l=0,c=t.pop(),h=r;0<h;h--)void 0!==c?(12<++n&&(s++,n%=12),c.Year==s.toString()&&c.Month==n.toString()?(a=timeSeriesChart.options.showAccumulation?l+=parseInt(c.arrest_count):parseInt(c.arrest_count),o.push(a),0<t.length&&(c=t.pop())):(a=timeSeriesChart.options.showAccumulation?l:0,o.push(a))):o.push(0);return o},getXDates:function(){for(var e=["x"],t=new Date(dateRangeController.getStart()),a=new Date(dateRangeController.getEnd()),a=12*(a.getFullYear()-t.getFullYear())+(a.getMonth()-t.getMonth())+1,i=t.getFullYear(),r=t.getMonth()+1,s=a-1;0<s;s--)12<++r&&(i++,r%=12),e.push(i+"-"+(r<10?"0"+r:r)+"-01");return e},toggleExpand:function(e){timeSeriesChart.options.$targetElement.toggleClass("expanded"),timeSeriesChart.options.isExpanded=!timeSeriesChart.options.isExpanded,timeSeriesChart.options.isExpanded?timeSeriesChart.options.$expandBtnElement.html("Collapse"):timeSeriesChart.options.$expandBtnElement.html("Expand"),this.parent.Utilities.googleTracking.sendTrackEvent("mainChart","expand toggle"),timeSeriesChart.renderChart()}};class DateRangeControl{constructor(e){this.start_date="2000-01-01",this.end_date="",this.parent=e,this.setHash(),this.setupDateRangePicker(),this.setupDateRangePickerEvents()}setupDateRangePicker(e){var e=[{text:"Last 3 Months",dateStart:()=>moment().subtract("months",3),dateEnd:()=>moment()},{text:"Last 6 Months",dateStart:()=>moment().subtract("months",6),dateEnd:()=>moment()},{text:"Last Year",dateStart:()=>moment().subtract("years",1),dateEnd:()=>moment()},{text:"Last 5 Years",dateStart:()=>moment().subtract("years",5),dateEnd:()=>moment()},{text:"All Records",dateStart:()=>moment("2000-01-01"),dateEnd:()=>moment()}],t=this.parent.Utilities.mobileCheck()?1:2;$("#dateRangeJquery").daterangepicker({presetRanges:e,datepickerOptions:{minDate:new Date("2000-01-01"),maxDate:0,numberOfMonths:t}})}setupDateRangePickerEvents(){this.setDefaultDate();var e={start:moment(this.start_date).toDate(),end:moment(this.end_date).toDate()};$("#dateRangeJquery").daterangepicker("setRange",e),$("#dateRangeJquery").on("change",()=>{this.changeDateRange(this)}),$("#dateRangeJquery").on("open",()=>this.parent.Utilities.googleTracking.sendTrackEvent("DateRange","OpenDialog"))}open(){$("#dateRangeJquery").daterangepicker("open")}close(){$("#dateRangeJquery").daterangepicker("close")}resetTime(e){this.parent.Utilities.googleTracking.sendTrackEvent("DateRange","Reset");var t=this.getToday();this.setDates("2000-01-01",t)}setDefaultDate(){var e=moment().format("YYYY-MM-DD");this.start_date=this.getCookie("start_date")||"2000-01-01",this.end_date=this.getCookie("end_date")||e}getToday(){var e=new Date,t=e.getMonth()<9?"0"+(e.getMonth()+1):e.getMonth()+1,a=e.getDate()<10?"0"+e.getDate():e.getDate();return e.getFullYear()+"-"+t+"-"+a}getStart(){return this.start_date}getEnd(){return this.end_date}setHash(){}changeDateRange(e){var t=JSON.parse($("#dateRangeJquery").val()),a=t.start,i=t.end;new Date(a)>new Date(i)&&(t=a,a=i,i=t),e.setDates(a,i)}setDates(e,t){this.setCookie("start_date",e),this.setCookie("end_date",t),this.start_date=e,this.end_date=t,window.CustomEvent&&(new Event("dateRangeChanged"),$("#dateRangeJquery").trigger("dateRangeChanged"),this.parent.Utilities.googleTracking.sendTrackEvent("DateRange","DateChanged"))}setCookie(e,t,a){return this.parent.Utilities.setCookieValue(e,t,a)}getCookie(e){return this.parent.Utilities.getCookieValue(e)}}class StyleSheetManager{constructor(){this.stylesheets=["css/styles.min.css","css/vendor/normalize.min.css","css/vendor/skeleton.min.css","css/vendor/c3.css","css/vendor/jquery-ui.min.css","css/vendor/jquery.comiseo.daterangepicker.css"],this.loadStylesheets()}loadCSS(e){var t,a;return t=document,a=t.createElement("LINK"),t=t.getElementsByTagName("LINK")[0],a.href=e,a.rel="stylesheet",t.parentNode.insertBefore(a,t),!0}loadStylesheets(e){for(var t=e||this.stylesheets||[],a=!0,i=0;i<t.length;i++)a=this.loadCSS(t[i]),DEBUG&&console.log(t[i]+" Loaded");return a}}var StyleSheetManagerInstance=new StyleSheetManager;function loadCSS(e){DEBUG&&console.warn("Deprecated loadCSS("+e+") function called!"),StyleSheetManagerInstance.loadCSS(e)}